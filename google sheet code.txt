const SHEET_NAME = "Trang tÃ­nh1"; // CÃI TÃŠN NÃ€Y CHá»Š PHáº¢I COI á» DÆ¯á»šI GÃ“C TRÃI GOOGLE SHEET. Báº°NG TIáº¾NG ANH LÃ€ Sheet1, TIáº¾NG VIá»†T LÃ€ Trang tÃ­nh1. HÃ£y thay Ä‘á»•i náº¿u báº¡n Ä‘á»•i tÃªn Sheet.
const EMAIL_TO = "xuxule779@gmail.com"; // THAY Báº°NG EMAIL Cá»¦A Báº N Äá»‚ NHáº¬N THÃ”NG BÃO

function doPost(e) {
  try {
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_NAME);
    if (!sheet) {
      throw "KhÃ´ng tÃ¬m tháº¥y Sheet cÃ³ tÃªn: " + SHEET_NAME;
    }
    
    // Tá»± Ä‘á»™ng táº¡o Header náº¿u chÆ°a cÃ³
    const expectedHeaders = ['Date', 'Name', 'Email', 'Phone', 'Experience', 'Adults', 'Children', 'JourneyDate', 'Details'];
    if (sheet.getLastRow() === 0) {
      sheet.getRange(1, 1, 1, expectedHeaders.length).setValues([expectedHeaders]);
      sheet.getRange(1, 1, 1, expectedHeaders.length).setFontWeight("bold").setBackground("#FBF7F0");
    }

    const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
    const nextRow = sheet.getLastRow() + 1;
    
    const rowData = [];
    const timestamp = new Date();
    
    // Soáº¡n ná»™i dung Email
    let emailBody = "Báº¡n cÃ³ má»™t yÃªu cáº§u Ä‘áº·t xe má»›i tá»« Website Xuxu Chauffeur:\n\n";
    emailBody += "--- THÃ”NG TIN CHI TIáº¾T ---\n";

    for (let i = 0; i < expectedHeaders.length; i++) {
      if (expectedHeaders[i] === 'Date') {
        rowData[i] = timestamp;
      } else {
        const fieldName = expectedHeaders[i];
        const value = e.parameter[fieldName] || "";
        rowData[i] = value;
        emailBody += `${fieldName}: ${value}\n`;
      }
    }
    
    // LÆ°u vÃ o Google Sheet
    sheet.getRange(nextRow, 1, 1, rowData.length).setValues([rowData]);
    
    // Gá»­i Email
    MailApp.sendEmail({
      to: EMAIL_TO,
      subject: "ğŸ”´ Má»šI: YÃªu cáº§u Ä‘áº·t dá»‹ch vá»¥ Xuxu Chauffeur tá»« " + (e.parameter["Name"] || "KhÃ¡ch HÃ ng"),
      body: emailBody
    });

    return ContentService
      .createTextOutput(JSON.stringify({ 'result': 'success' }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({ 'result': 'error', 'error': String(error) }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
